---
title: '9.4.14 الگو Pipeline'
slug: go-concurrency-pattern-pipeline
weight: 177014
---


## 9.4.14.1 توضیحات

الگو خط لوله (Pipeline) یکی از پرکاربردی ترین الگوها در همزمانی می باشد شما با استفاده از این الگو می توانید تسک های بزرگ را به تسک های کوچکتر و مستقل تقسیم کنید که می توانند بطور همزمان کار کنند. هر stage داخل یک گوروتین انجام می شود و بواسطه کانال داده ها بین stage های مختلف منتقل می شود.


## 9.4.14.2 دیاگرام

{{<img url="#" image="../../../assets/img/content/chapter9/concurrent/5.png" alt="pipeline">}}

## 9.4.14.3 نمونه کد

```go
package main

import "fmt"

func gen(nums ...int) <-chan int {
	out := make(chan int)
	go func() {
		defer close(out)
		for _, n := range nums {
			out <- n
		}
	}()
	return out
}

func sq(in <-chan int) <-chan int {
	out := make(chan int)
	go func() {
		defer close(out)
		for n := range in {
			out <- n * n
		}
	}()
	return out
}

func main() {
	// Set up the pipeline.
	c := gen(2, 3)
	out := sq(c)

	// Consume the output.
	fmt.Println(<-out) // 4
	fmt.Println(<-out) // 9
}
```

```shell
$ go run main.go
4
9
```

در مثال فوق ما یک قصد داریم اعدادی را مربع کنیم :

- در stage اول تابع gen لیست اعدادی را به عنوان ورودی دریافت می کنند و سپس داخل کانال قرار می دهد و سپس کانال فقط دریافت را بازگشت می دهد.
- در stage دوم تابع sq کانال فقط دریافتی را به عنوان ورودی میگیرد سپس از طریق کانال اعداد را دریافت می کنیم و اعداد را مربع می کنیم و به کانال می فرستیم و در نهایت کانال را بازگشت می دهیم.
- تابع main شروع کننده Pipeline ما می باشد که در ابتدا اعداد را به تابع gen میفرست و یک کانال فقط دریافت می دهد و این کانال را به stage دوم تابع sq پاس می دهیم تا اعداد مربع شوند. و در آخر از طریق کانال مقادیر مربع شده را می توانیم دریافت کنیم و نمایش دهیم.

**نکات مهم :**

1. در الگو Pipeline مرحله (stage) اول فقط داده هایی که قرار است عملیات را انجام دهیم پاس می دهیم.
2. در سایر stage های به عنوان ورودی و خروجی کانال فقط دریافتی به عنوان پارامتر قرار می دهیم.
3. گوروتین داخل هر stage اجرا می شود و از تابع inline استفاده می کنیم.
4. کانال را داخل گوروتین داخل defer قرار دهید که پس از عملیات کانال بسته شود.
5. از context می توانید برای کنترل عملیات داخل هر stage استفاده کنید, به عنوان مثال اگر قصد داشته باشید عملیاتی را که هر stage هست متوقف کنید کافیه از context استفاده کنید تا کنترل بیشتری داشته باشید.

[یک مثال کاربردی دیگر](https://github.com/Ja7ad/random-string-hasher)

## 9.4.14.4 کاربردها

- **شبکه :** یک Pipeline می تواند برای مدیریت چندین اتصال شبکه ورودی با عبور از چندین مرحله مانند تجزیه، فیلتر کردن و مسیریابی استفاده شود.
- **محاسبات چند مرحله ای:** یک Pipeline می تواند برای انجام یک سری محاسبات روی داده های ورودی استفاده شود که در آن خروجی یک مرحله به عنوان ورودی برای مرحله بعدی استفاده می شود.
- **پردازش گزارش:** یک Pipeline می تواند برای پردازش داده های گزارش با عبور دادن آنها از مراحل مختلف مانند فیلتر کردن، تجزیه، غنی سازی و نمایه سازی استفاده شود.
- **تجزیه و تحلیل داده ها:** یک Pipeline می تواند برای پردازش مجموعه داده های بزرگ با عبور از مراحل مختلف مانند فیلتر کردن، نقشه برداری و کاهش استفاده شود.